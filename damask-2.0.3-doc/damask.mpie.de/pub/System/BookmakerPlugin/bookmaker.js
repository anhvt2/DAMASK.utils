Bookmaker={jstree_options:{plugins:["json_data","themes","dnd","crrm"],dnd:{drop_target:false,drag_target:false},crrm_options:{move:{}},themes:{theme:"apple"}}};(function(a){a(document).ready(function(){a("#bookmaker_more").hide();a("#bookmaker_contract").click(function(){a("#bookmaker_expand").fadeIn();a(".bookmaker_active").fadeIn();a("#bookmaker_more").slideUp()});a(".bookmaker_action").hide();a(".bookmaker_active").show();var b=function(g,e){var e;var h;var d=g[0].validation_key?StrikeOne.calculateNewKey(g[0].validation_key.value):null;if(!e){if(d){g[0].validation_key=d}h=g.serialize();e=g.attr("action")}else{if(d){h={validation_key:d};var c=e.split("?");if(c.length>1){e=c[0];var j=c[1].split(/[;&]/);for(var f in j){var i=j[f].split("=");h[i[0]]=i[1]}}}}a.ajax({type:g.attr("method"),url:e,data:h,dataType:"script",error:function(m,l,k){alert(l)}})};a("#book_title").change(function(){a("#new_book").fadeOut();a("#bookmaker_change").fadeIn();a(this).closest("form").submit();return false});a("#bookmaker_change").click(function(c){a("#bookmaker_change").fadeOut();a("#new_book").fadeIn()});a(".bookmaker_button").click(function(c){b(a(this).closest("form"),a(this).attr("href"));return false});a("#book_tree").bind("move_node.jstree",function(f,d){var c=a("#book_tree").jstree("get_settings").move_url;d.rslt.o.each(function(e){a.ajax({async:false,type:"POST",url:c,data:{what:a(this).attr("topic"),new_parent:d.rslt.np.attr("topic"),new_pos:d.rslt.cp+e},error:function(i,h,g){console.debug("Move failed "+h);a.jstree.rollback(d.rlbk)}})})})})})(jQuery);