!function(e){ChiliBook={version:"2.2",automatic:!0,automaticSelector:"code",lineNumbers:!1,codeLanguage:function(r){var n=e(r).attr("class");return n||""},recipeLoading:!0,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date).valueOf()}},e.fn.chili=function(r){function n(r,t,a){function c(e,r,n){var t=e[r][n],i="string"==typeof t._match?t._match:t._match.source;return{recipe:e,blockName:r,stepName:n,exp:"("+i+")",length:1+(i.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:t._replace?t._replace:s.defaultReplacement}}function l(e){for(var r=1,n=[],i=0;i<e.length;i++){var a=e[i].exp;a=a.replace(/\\\\|\\(\d+)/g,function(e,n){return n?"\\"+(r+1+parseInt(n,10)):e}),n.push(a),r+=e[i].length}var c="(?:"+n.join("|")+")";return c="((?:\\s|\\S)*?)"+c+"|((?:\\s|\\S)+)",new RegExp(c,t._case?"g":"gi")}function u(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function p(e){return e.replace(/ +/g,function(e){return e.replace(/ /g,w)})}function f(e){return e=u(e),w&&(e=p(e)),e}function g(e,r){return n(e,r)}function h(e,r,t){return n(e,r,t)}function d(e,r,n,t){s.replaceSpace;var i=[c(r,n,t)];return e.replace(l(i),function(){return b.apply({steps:i},arguments)})}function v(r,n,t){function i(e){var r=o(e),n=s.recipes[r];if(!n)throw{msg:"recipe not available"};return n}if(!n)return f(r);var a=n.split("/"),c="",l="",u="";switch(a.length){case 1:c=a[0];break;case 2:c=a[0],l=a[1];break;case 3:c=a[0],l=a[1],u=a[2];break;default:return f(r)}try{var p;if(""!=u)return p=""==c?t.recipe:i(c),""==l&&(l=t.blockName),l in p&&u in p[l]?d(r,p,l,u):f(r);if(""!=l)return p=""==c?t.recipe:i(c),l in p?h(r,p,l):f(r);if(""!=c)return p=i(c),g(r,p)}catch(i){if(i.msg&&"recipe not available"==i.msg){var m="chili_"+s.unique();if(s.recipeLoading){var b=o(c);if(s.queue[b])s.queue[b].push({cue:m,subject:r,module:n,context:t});else try{s.queue[b]=[{cue:m,subject:r,module:n,context:t}],e.ajax({url:b,dataType:"text",success:function(r){s.recipes[b]=window.eval("(function() { var recipe = "+r+"; return recipe; }())");for(var n=s.queue[b],t=0,i=n.length;t<i;t++){var a=v(n[t].subject,n[t].module,n[t].context);s.replaceTab&&(a=a.replace(/\t/g,s.replaceTab)),s.replaceNewLine&&(a=a.replace(/\n/g,s.replaceNewLine)),e("#"+n[t].cue).replaceWith(a)}}})}catch(e){alert("the recipe for '"+c+"' was not found in '"+b+"'")}return'<span id="'+m+'">'+f(r)+"</span>"}return f(r)}return f(r)}}function m(e,r){return r.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/gi,"$1"+e+"__$3")}function b(){if(!arguments[0])return"";var r=this.steps,n=0,t=2,i=arguments[1],a=arguments[arguments.length-3];if(a)return f(a);for(var c;c=r[n++];){var l=arguments;if(l[t]){var o="";if(e.isFunction(c.replacement)){for(var u=[],p=0,s=c.length;p<s;p++)u.push(l[t+p]);u.push(l[l.length-2]),u.push(l[l.length-1]),o=c.replacement.apply({x:function(){return v(arguments[0],arguments[1],{recipe:c.recipe,blockName:c.blockName})}},u)}else o=c.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(e,r,n){return r?"$":n?"0"==n?c.stepName:f(l[t+parseInt(n,10)]):f(l[t])});return o=m(c.recipe._name,o),f(i)+o}t+=c.length}}if(a||(a="_main",i(t)),!(a in t))return f(r);var w=s.replaceSpace,x=function(e,r){var n=[];for(var t in e[r])n.push(c(e,r,t));return n}(t,a),y=l(x);return r.replace(y,function(){return b.apply({steps:x},arguments)})}function t(e){if(document.createElement){var r=document.createElement("style");if(r.type="text/css",r.styleSheet)r.styleSheet.cssText=e;else{var n=document.createTextNode(e);r.appendChild(n)}document.getElementsByTagName("head")[0].appendChild(r)}}function i(e){var r=e._name;if(!s.queue[r]){var n=["/* Chili -- "+r+" */"];for(var i in e)if(i.search(/^_(?!main\b)/)<0)for(var a in e[i]){var c=e[i][a];if("_style"in c)if(c._style.constructor==String)n.push("."+r+"__"+a+" { "+c._style+" }");else for(var l in c._style)n.push("."+r+"__"+l+" { "+c._style[l]+" }")}t(n=n.join("\n")),s.queue[r]=!0}}function a(r){var n=s.codeLanguage(r);if(""!=n){var t=o(n);if(s.recipeLoading){if(s.queue[t])s.queue[t].push(r);else try{s.queue[t]=[r],e.ajax({url:t,dataType:"text",success:function(e){s.recipes[t]=window.eval("(function() { var recipe = "+e+"; return recipe; }())");for(var r=s.queue[t],n=0,i=r.length;n<i;n++)c(r[n],t)}})}catch(e){alert("the recipe for '"+n+"' was not found in '"+t+"'")}c(r,t)}else c(r,t)}}function c(r,t){var i=s.recipes[t];if(i){var a=e(r),c=a.text();if(c){c=c.replace(/\r\n?/g,"\n"),a.parent().is("pre")&&(e.browser.safari||(c=c.replace(/^\n/g,"")));var o=n(c,i);s.replaceTab&&(o=o.replace(/\t/g,s.replaceTab)),s.replaceNewLine&&(o=o.replace(/\n/g,s.replaceNewLine)),r.innerHTML=o,(e.browser.msie||e.browser.mozilla)&&l(r);var u=a.parent(),f=u.attr("class"),g=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(f);if(g){p(r);var h=0;if(g[1]){h=parseInt(g[1],10);var d=e(".ln-"+g[1]+"-"+g[2]),v=d.index(u[0]);d.slice(0,v).each(function(){h+=e(this).find("li").length})}else h=g[3]?parseInt(g[3],10):1;a.find("ol")[0].start=h,e("body").width(e("body").width()-1).width(e("body").width()+1)}else s.lineNumbers&&p(r)}}}function l(r){var n=null;e(r).parents().filter("pre").bind("mousedown",function(){n=this,e.browser.msie?document.selection.empty():window.getSelection().removeAllRanges()}).bind("mouseup",function(r){if(n&&n==this){n=null;var t="";if(e.browser.msie){if(""==(t=document.selection.createRange().htmlText))return;t=u(t);i='<textarea style="STYLE">'}else{if(""==(t=window.getSelection().toString()))return;t=t.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");var i='<pre style="STYLE">'}var a=e(i.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(t).attr("id","chili_selection").click(function(){e(this).remove()}),c=r.pageY-Math.round(a.height()/2)+"px",l=r.pageX-Math.round(a.width()/2)+"px";if(a.css({top:c,left:l}),e.browser.msie)a[0].focus(),a[0].select();else{var o=window.getSelection();o.removeAllRanges();var p=document.createRange();p.selectNodeContents(a[0]),o.addRange(p)}}})}function o(e){return s.recipeFolder+e+".js"}function u(r){do{var n=ChiliBook.unique()}while(r.indexOf(n)>-1);var t="";if(/<br/i.test(r)||/<li/i.test(r)){/<br/i.test(r)?r=r.replace(/\<br[^>]*?\>/gi,n):/<li/i.test(r)&&(r=r.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/gi,"").replace(/<\/li>/gi,n));var i=e("<pre>").appendTo("body").hide()[0];i.innerHTML=r,t=e(i).text().replace(new RegExp(n,"g"),"\r\n"),e(i).remove()}return t}function p(r){function n(e,r,n,t){var i=t?"</span>":"",a="";return e?a="<li>"+t+r+i+"</li>":n&&(a="<li>"+t+n+i+"</li>"),a}function t(e,r,t,i){return i||n(e,r,t,"")}var i=e(r).html(),a=/<br>/.test(i)?"<br>":"<BR>",c="<li>"+s.replaceSpace+"</li>",l=i.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/gi,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/gi,function(e,r,t,i){if(/<br>/i.test(i)){var c=r.split(a),l=c.pop();return((r=c.join(a))?r+a:"")+(l+i).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/gi,function(e,r,i,a){return n(r,i,a,t)})}return e}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/gi,function(e,r,n,i,a){return t(n,i,a,r)}).replace(/<li><\/li>/gi,c);r.innerHTML="<ol>"+l+"</ol>"}var s=e.extend({},ChiliBook,r||{});return this.each(function(){var r=e(this);r.trigger("chili.before_coloring"),a(this),r.trigger("chili.after_coloring")}),this}}(jQuery);
