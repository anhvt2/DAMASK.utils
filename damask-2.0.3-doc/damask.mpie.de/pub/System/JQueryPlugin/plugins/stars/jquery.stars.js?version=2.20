"use strict";!function(a){var n={split:1,numStars:5};function e(t,e){var s=this;s.elem=a(t),s.opts=a.extend({},n,e),s.init()}e.prototype._toFixed=function(t){return t=Number(t),Number(t.toFixed(this._prec))},e.prototype.init=function(){var s,n,o=this;o.elem.removeClass("jqStars").addClass("jqStarsInput").wrap("<div class='jqStars jqStarsInited' />"),o.mapping={},o.opts.values&&(o.opts.values.constructor===String?o.opts.values=o.opts.values.split(/\s*,\s*/):o.opts.values.constructor===Array&&(n=[],a.each(o.opts.values,function(t,e){if(e.constructor===Object)for(s in e)o.mapping[e[s]]=s,n.push(e[s]);else n.push(e)}),o.opts.values=n),o.opts.numStars=o.opts.values.length,o.opts.split=1),o._prec=0,1<o.opts.split&&o._prec++,10<o.opts.split&&o._prec++,100<o.opts.split&&o._prec++,o.blockMouseMove=!1,o.timeoutId=void 0,o.elem.hide(),o.container=a("<div />").addClass("jqStarsContainer").insertAfter(o.elem),o.labelElem=a("<span />").addClass("jqStarsLabel").insertAfter(o.container),o.onElem=a("<div />").addClass("jqStarsOn").appendTo(o.container),o.widthStar=parseInt(o.container.css("background-size"),10),o.width=o.opts.numStars*o.widthStar,o.container.width(o.width),o.elem.is(":disabled")?o.container.addClass("jqStarsReadOnly"):(o.deleteElem=a("<div />").addClass("jqStarsDelete").insertAfter(o.elem),o.container.on("mousemove",function(t){o.blockMouseMove||o.displayAtIndex((t.pageX-o.container.offset().left)/o.widthStar)}),o.container.on("mouseleave",function(){o.blockMouseMove&&(void 0!==o.timeoutId&&window.clearTimeout(o.timeoutId),o.timeoutId=window.setTimeout(function(){o.blockMouseMove=!1,o.timeoutId=void 0},1e3)),o.display(o.elem.val()),o.container.removeClass("jqStarsSelected")}),o.container.on("mouseenter",function(){o.elem.focus(),o.blockMouseMove=!1}),o.container.on("click",function(t){return o.displayAtIndex((t.pageX-o.container.offset().left)/o.widthStar),o.container.addClass("jqStarsSelected"),o.blockMouseMove=!0,o.selectAtIndex(o._tmpIndex),!1}),o.deleteElem.hover(function(){o.display()},function(){o.display(o.elem.val())}),o.deleteElem.on("click",function(){return o.select(),!1}),o.container.on("mousewheel",function(t){var e=1/o.opts.split;return 0<t.deltaY?(o._tmpIndex+=e,o._tmpIndex>o.opts.numStars&&(o._tmpIndex=o.opts.numStars)):(o._tmpIndex-=e,o._tmpIndex<0&&(o._tmpIndex=0)),o._tmpIndex=o._toFixed(o._tmpIndex),o.selectAtIndex(o._tmpIndex),o.container.addClass("jqStarsSelected"),o.blockMouseMove=!0,!1}),a(document).on("keydown",function(t){if(o.container.is(":hover")){var e=1/o.opts.split,s=!1;switch(t.keyCode){case 38:case 33:o._tmpIndex=Math.round(o._tmpIndex+1),s=!0;break;case 40:case 34:o._tmpIndex=Math.round(o._tmpIndex-1),s=!0;break;case 35:o._tmpIndex=o.opts.numStars,s=!0;break;case 36:s=!(o._tmpIndex=0);break;case 37:o._tmpIndex-=e,s=!0;break;case 39:o._tmpIndex+=e,s=!0;break;default:s=!1}if(s)return o._tmpIndex>o.opts.numStars&&(o._tmpIndex=o.opts.numStars),o._tmpIndex<0&&(o._tmpIndex=0),o._tmpIndex=o._toFixed(o._tmpIndex),o.selectAtIndex(o._tmpIndex),!1}})),o.select(o.elem.val())},e.prototype.getDisplayVal=function(t){var e,s=this;return s.opts.values?(e=s.opts.values[t-1],void 0!==s.mapping[e]&&(e=s.mapping[e])):e=sprintf("%."+s._prec+"f",t),e},e.prototype.displayAtIndex=function(t){var e,s,n=this;void 0===t||0===t?(e=0,s=""):(t=Math.ceil(t*n.opts.split)/n.opts.split,t=n._toFixed(t),e=n.widthStar*t,s=n.getDisplayVal(t)),t!==n._tmpIndex&&(n.onElem.width(e),n.labelElem.html(s),n._tmpIndex=t,n.elem.trigger("display.stars",t,s))},e.prototype.display=function(t){var e,s=this;e=void 0===t||""===t||0===t?void 0:void 0!==s.opts.values?s.opts.values.indexOf(t)+1:t,s.displayAtIndex(e)},e.prototype.selectAtIndex=function(t){var e,s=this;e=(s._tmpIndex=void 0)===t||0===t?"":void 0!==s.opts.values?s.opts.values[t-1]:t,s.displayAtIndex(t),e=sprintf("%."+s._prec+"f",t),s.elem.val(e)},e.prototype.select=function(t){var e=this;e._tmpIndex=void 0,e.display(t),e.elem.val(t)},a.fn.stars=function(t){return this.each(function(){a.data(this,"_stars")||a.data(this,"_stars",new e(this,t))})},a(function(){a(".jqStars:not(.jqStarsInited)").livequery(function(){var t=a(this),e=a.extend({},t.data(),t.metadata());t.stars(e)})})}(jQuery);
