"use strict";!function(p){p.fn.extend({textboxlist:function(e){var t=p.extend({},p.TextboxLister.defaults,e);return this.each(function(){p.data(this,"textboxlist")||p.data(this,"textboxlist",new p.TextboxLister(this,t))})}}),p.TextboxLister=function(e,t){var l=this;return l.input=p(e),(e.textboxList=l).opts=p.extend({},l.input.data(),l.input.metadata(),t),l.opts.inputName||(l.opts.inputName=l.input.attr("name")),l.container=l.input.wrap("<div />").parent().addClass(l.opts.containerClass).addClass("clearfix"),l.opts.enableClose&&l.container.addClass("jqTextboxListEnableClose"),"manual"===l.opts.sorting&&l.container.sortable({items:"> ."+l.opts.listValueClass,placeholder:"jqTextboxListPlaceholder",forcePlaceholderSize:!0,update:function(e,t){var n=[];p.each(l.container.sortable("toArray",{attribute:"class"}),function(e,t){var l=[];p.map(t.split(/\s+/),function(e){l.push("."+e)}),l=l.join(""),p(l).find("input").each(function(){n.push(p(this).val())})}),l.currentValues=n}}),l.opts.clearControl&&p(l.opts.clearControl).click(function(){return l.clear(),this.blur(),!1}),l.opts.resetControl&&p(l.opts.resetControl).click(function(){return l.reset(),this.blur(),!1}),l.opts.autocomplete?(p.extend(l.opts,{source:l.opts.autocomplete,select:function(e,t){return p.log("TEXTBOXLIST: selected value="+t.item.value+" label="+t.item.label),l.select(t.item.value+"="+t.item.label),!1}}),l.input.attr("autocomplete","off").autocomplete(l.opts)):p.log("TEXTBOXLIST: no autocomplete"),l.input.bind("keydown.textboxlist",function(e){if(13===e.keyCode){var t=l.input.val();if(t)return p.log("TEXTBOXLIST: closing suggestion list"),l.opts.autocomplete&&l.input.autocomplete("close"),l.select(t),e.preventDefault(),!1}}),l.input.bind("AddValue",function(e,t){p.log("TEXTBOXLIST: got add event, val="+t),t&&l.select(t)}),l.input.bind("DeleteValue",function(e,t){t&&l.deselect([t])}),l.input.bind("Reset",function(){l.reset()}),l.input.bind("Clear",function(){l.clear()}),l.currentValues=[],l.titleOfValue=[],l.input.val()&&l.select(l.input.val().split(/\s*,\s*/),!0),l.initialValues=l.currentValues.slice(),l.input.removeClass("foswikiHidden").show(),this},p.TextboxLister.prototype.clear=function(){p.log("TEXTBOXLIST: called clear");var e=this;e.container.find("."+e.opts.listValueClass).remove(),e.currentValues=[],e.titleOfValue=[],"function"==typeof e.opts.onClear&&(p.log("TEXTBOXLIST: calling onClear handler"),e.opts.onClear(e))},p.TextboxLister.prototype.reset=function(){p.log("TEXTBOXLIST: called reset");var e=this;e.clear(),e.select(e.initialValues),"function"==typeof e.opts.onReset&&(p.log("TEXTBOXLIST: calling onReseet handler"),e.opts.onReset(e))},p.TextboxLister.prototype.select=function(e,t){p.log("TEXTBOXLIST: called select("+e+") "+typeof e);var l,n,o,s,a,i,r,u,c=this;for("string"==typeof e?e=e.split(/\s*,\s*/):void 0===e&&(e=[]),l=0;l<e.length;l++)a=!1,(o=e[l])&&(s=o).match(/^(.*)=(.*)$/)&&(e[l]=o=RegExp.$1,c.titleOfValue["_"+o]=RegExp.$2);if(0<c.currentValues.length){for(l=0;l<e.length;l++)if(a=!1,o=e[l]){for(n=0;n<c.currentValues.length;n++)if(c.currentValues[n]===o){a=!0;break}a||c.currentValues.push(o)}}else for(c.currentValues=[],l=0;l<e.length;l++)(o=e[l])&&c.currentValues.push(o);for(!0===c.opts.sorting&&(c.currentValues=c.currentValues.sort()),p.log("TEXTBOXLIST: self.currentValues="+c.currentValues+" length="+c.currentValues.length),c.container.find("."+c.opts.listValueClass).remove(),l=c.currentValues.length-1;0<=l;l--)(o=c.currentValues[l])&&(s=c.titleOfValue["_"+o]||o,p.log("TEXTBOXLIST: val="+o+" title="+s),u="tag_"+s.replace(/["' ]/,"_"),i=p("<input type='hidden' name='"+c.opts.inputName+"' title='"+s+"' />").val(o),c.input.is(".foswikiMandatory")&&i.addClass("foswikiMandatory"),c.opts.enableClose&&(r=p("<a href='#' title='remove "+s+"'></a>").addClass(c.opts.closeClass).click(function(e){return e.preventDefault(),c.input.trigger("DeleteValue",p(this).parent().find("input").val()),!1})),p("<span></span>").addClass(c.opts.listValueClass+" "+u).append(i).append(r).append(s).prependTo(c.container));c.input.val(""),t||"function"!=typeof c.opts.onSelect||(p.log("TEXTBOXLIST: calling onSelect handler"),c.opts.onSelect(c)),c.input.trigger("SelectedValue",e)},p.TextboxLister.prototype.deselect=function(e){p.log("TEXTBOXLIST: called deselect("+e+")");var t,l,n,o,s,a=this,i=[];if("string"==typeof e&&(e=e.split(/\s*,\s*/)),e.length){for(t=0;t<a.currentValues.length;t++)if(n=a.currentValues[t]){for(o=!1,l=0;l<e.length;l++)if((s=e[l])&&n===s){o=!0;break}!o&&n&&i.push(n)}a.currentValues=i,"function"==typeof a.opts.onDeselect&&(p.log("TEXTBOXLIST: calling onDeselect handler"),a.opts.onDeselect(a)),a.select(i,!0)}},p.TextboxLister.defaults={containerClass:"jqTextboxListContainer",listValueClass:"jqTextboxListValue",closeClass:"jqTextboxListClose",enableClose:!0,sorting:"manual",inputName:void 0,resetControl:void 0,clearControl:void 0,autocomplete:void 0,onClear:void 0,onReset:void 0,onSelect:void 0,onDeselect:void 0}}(jQuery);
