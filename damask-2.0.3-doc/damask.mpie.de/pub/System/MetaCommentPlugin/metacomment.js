"use strict";jQuery(function(e){var t=!1;e(".cmtComments:not(.cmtCommentsInited)").livequery(function(){var n,o=e(this),i=o.parent(),r={topic:foswiki.getPreference("TOPIC"),web:foswiki.getPreference("WEB"),updateMessage:"Updating comment",deleteMessage:"Deleting comment",approveMessage:"Approving comment",markingMessage:"Marking comment"},m=e.extend({},r,o.data(),o.metadata());function a(n){t?(e(".cmtDialog form").resetForm(),n.call()):(t=!0,e.get(foswiki.getPreference("SCRIPTURL")+"/rest/RenderPlugin/template",{name:"metacomments",render:"on",topic:m.web+"."+m.topic,expand:"comments::dialogs"},function(t){e("body").append(t),window.setTimeout(n,100)}))}o.find(".cmtComment").hover(function(){var t=e(this),n=t.children(".cmtControls");t.addClass("cmtHover"),n.stop(!0,!0).fadeIn(500)},function(){var t=e(this);t.children(".cmtControls").stop(!0,!0).hide(),t.removeClass("cmtHover")}),e(".cmtJsonRpcForm").livequery(function(){var t=e(this),n=t.data("message");t.ajaxForm({beforeSerialize:function(){"undefined"!=typeof foswikiStrikeOne&&foswikiStrikeOne(t[0])},beforeSubmit:function(){t.is(".cmtModalForm")&&t.parent().dialog("close"),e.blockUI({message:"<h1>"+n+" ...</h1>",fadeIn:0,fadeOut:0})},success:function(t){var n;t.error?(e.unblockUI(),e.pnotify({text:"Error: "+t.error.message,type:"error"})):(n=foswiki.getPreference("SCRIPTURL")+"/rest/RenderPlugin/template?name=metacomments;render=on;topic="+m.web+"."+m.topic+";expand=metacomments",i.load(n,function(){e.unblockUI(),i.height("auto")}))},error:function(t){var n=e.parseJSON(t.responseText);e.unblockUI(),e.pnotify({text:"Error: "+n.error.message,type:"error"})}})}),o.find(".cmtReply").click(function(){var t=e(this).parents(".cmtComment:first"),n=e.extend({},t.metadata());return a(function(){e("#cmtReplyComment").dialog("option","open",function(){var t=e(this);t.find(".cmtCommentIndex").text(n.index),t.find("input[name='ref']").val(n.comment_id)}).dialog("open")}),!1}),o.find(".cmtEdit").click(function(){var t=e(this).parents(".cmtComment:first"),n=e.extend({},t.metadata());return a(function(){e.jsonRpc(foswiki.getPreference("SCRIPTURL")+"/jsonrpc",{namespace:"MetaCommentPlugin",method:"getComment",params:{topic:m.web+"."+m.topic,comment_id:n.comment_id},success:function(t){e.unblockUI(),e("#cmtUpdateComment").dialog("option","open",function(){var o=e(this);o.find("input[name='comment_id']").val(n.comment_id),o.find("input[name='index']").val(n.index),o.find(".cmtCommentIndex").text(n.index),o.find("input[name='title']").val(t.result.title),o.find("textarea[name='text']").val(t.result.text)}).dialog("open")},error:function(t){e.unblockUI(),e.pnotify({text:"Error: "+t.error.message,type:"error"})}})}),!1}),o.find(".cmtDelete").click(function(){var t=e(this).parents(".cmtComment:first"),n=e.extend({},t.metadata());return a(function(){e("#cmtConfirmDelete").dialog("option","open",function(){var t=e(this);t.find("input[name='comment_id']").val(n.comment_id),t.find("input[name='index']").val(n.index),t.find(".cmtCommentNr").text(n.index),t.find(".cmtAuthor").text(n.author),t.find(".cmtDate").text(n.date)}).dialog("open")}),!1}),o.find(".cmtDeleteAll, .cmtApproveAll, .cmtMarkAll").click(function(){var t=e(this).attr("href");return a(function(){e(t).dialog("open")}),!1}),o.find(".cmtMark").click(function(){var t=e(this),n=t.data("message"),o=t.parents(".cmtComment:first"),i=e.extend({},o.metadata());return e.jsonRpc(foswiki.getPreference("SCRIPTURL")+"/jsonrpc",{namespace:"MetaCommentPlugin",method:"markComment",params:{topic:m.web+"."+m.topic,comment_id:i.comment_id},beforeSubmit:function(){e.blockUI({message:"<h1>"+n+" ...</h1>"})},success:function(){e.unblockUI(),t.parent().is(".cmtMarkContainer")?t.parent().remove():t.remove(),o.parent().removeClass("cmtCommentNew cmtCommentUpdated")},error:function(t){e.unblockUI(),e.pnotify({text:"Error: "+t.error.message,type:"error"})}}),!1}),o.find(".cmtApprove").click(function(){var t=e(this).parents(".cmtComment:first"),n=e.extend({},t.metadata());return a(function(){e("#cmtConfirmApprove").dialog("option","open",function(){var t=e(this);t.find("input[name='comment_id']").val(n.comment_id),t.find("input[name='index']").val(n.index),t.find(".cmtCommentNr").text(n.index),t.find(".cmtAuthor").text(n.author),t.find(".cmtDate").text(n.date)}).dialog("open")}),!1}),(n=window.location.hash).match(/^#comment\d+\.\d+$/)&&e.scrollTo(n.replace(/\./,"\\."),500,{easing:"easeInOutQuad"}),window.setTimeout(function(){o.find(".twistyPlugin").show()},1)})});
