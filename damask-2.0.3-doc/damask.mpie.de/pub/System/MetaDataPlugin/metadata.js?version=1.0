"use strict";!function(n){var a={hideActionDelay:1500};function e(t,e){var i=this;return i.elem=n(t),i.opts=n.extend({},a,e),i.init(),i}e.prototype.showActions=function(t){this.elem.find(".hover").removeClass("hover"),t.addClass("hover")},e.prototype.hideActions=function(){this.elem.find(".hover").removeClass("hover")},e.prototype.startTimer=function(){var t=this;t.timeout=setTimeout(function(){t.active||t.hideActions()},t.opts.hideActionDelay)},e.prototype.init=function(){var a=this;a.active=!1,a.elem.find(".metaDataActions").hover(function(){a.active=!0},function(){a.active=!1,a.startTimer()}),a.elem.on("mouseenter",".metaDataRow, tbody tr",function(){var t=n(this);t.find(".metaDataActions").length&&(a.active=!0,a.timeout&&clearTimeout(a.timeout),a.showActions(t))}).on("mouseleave",".metaDataRow, tbody tr",function(){a.active=!1,a.startTimer()}).on("click",".metaDataRow, tbody tr",function(t){var e=n(this),i=e.find(".metaDataEditAction");if(!a.elem.is(".metaDataReadOnly"))return e.effect("highlight"),n(t.target).is(".metaDataRow, td")&&(a.elem.find("tr").removeClass("selected"),e.addClass("selected"),i.length)?(i.trigger("click"),!1):void 0}).on("click",".metaDataEditAction",function(){var t=n(this),e=t.parents("tr:first"),i=e.next(),a=e.prev();a.find(".metaDataActions").length?t.data("metadata::prev","#"+a.find(".metaDataEditAction").attr("id")):t.data("metadata::prev",void 0),i.find(".metaDataActions").length?t.data("metadata::next","#"+i.find(".metaDataEditAction").attr("id")):t.data("metadata::next",void 0)})},n.fn.metaDataView=function(t){return this.each(function(){n.data(this,"metaDataView")||n.data(this,"metaDataView",new e(this,t))})},n(function(){n(".metaDataView").livequery(function(){var t=n(this),e=n.extend({},t.metadata({type:"elem",name:"script"}));t.metaDataView(e)})}),n.validator.addClassRules("foswikiMandatory",{required:!0})}(jQuery),function(n){var a={};function e(t,e){var i=this;return i.elem=n(t),i.opts=n.extend({},a,e),i.isModified=!1,"undefined"===i.elem.data("ui-dialog")?i.elem.on("dialogopen",function(){i.init()}):i.init(),i.elem.on("dialogclose",function(){i.unlock()}),i}e.prototype.unlock=function(){n.jsonRpc(foswiki.getPreference("SCRIPTURL")+"/jsonrpc",{namespace:"MetaDataPlugin",method:"unlock",params:{topic:foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC")},success:function(){},error:function(t){alert(t.error.message)}})},e.prototype.init=function(){var a=this;a.widget=a.elem.dialog("widget"),a.widget.find(".jqUIDialogDestroy").on("click",function(){a.unlock()}),a.elem.find("[name]").on("change",function(){if(!a.isModified){var t=a.widget.find(".ui-dialog-title");t.text(t.text()+" *"),a.isModified=!0}}),a.widget.find(".metaDataNext, .metaDataPrev").on("click",function(){var t=n(this).attr("selector"),e=a.elem.find("form");function i(){n(t).trigger("click").on("opened",function(){try{a.unlock(),a.elem.dialog("destroy")}catch(t){}a.elem.unblock(),a.elem.remove()})}return e.find("input[name='redirectto']").remove(),a.isModified?("undefined"!=typeof StrikeOne&&StrikeOne.submit(e[0]),e.ajaxSubmit({beforeSubmit:function(){a.elem.block({message:""})},success:function(){n.pnotify({text:n.i18n("Saved metadata record"),type:"success"}),i()},error:function(){n.pnotify({text:n.i18n("There was an error saving a record"),type:"error"})}})):i(),!1})},n.fn.metaDataEdit=function(t){return this.each(function(){n.data(this,"metaDataEdit")||n.data(this,"metaDataEdit",new e(this,t))})},n(function(){n(".metaDataEditDialog").livequery(function(){var t=n(this),e=t.data();t.metaDataEdit(e)})})}(jQuery);
