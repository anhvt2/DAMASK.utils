"use strict";!function(r){r.widget("solr.autosuggest",r.ui.autocomplete,{options:{thumbnailBase:null,delay:500,minLength:3,extraParams:{fields:"name,web,topic,container_title,title,type,thumbnail,icon,url,field_Telephone_s,field_Phone_s,field_Mobile_s"},limits:{global:3,persons:3,topics:3,attachments:3},position:{my:"right top",at:"right+5 bottom+11",collision:"none"},itemData:{phoneSchema:"tel"},templates:{persons:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}{{if phoneNumber}}<a class='ui-autosuggest-phone-number' href='{{:phoneSchema}}:{{:phoneNumber}}'></a>{{/if}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:title}}<div class='foswikiGrayText'>{{:phoneNumber}}</div></td></tr></table></a></li>",attachments:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:name}}<div class='foswikiGrayText'>{{:container_title}}</div></td></tr></table></a></li>",default:"<li class='ui-autosuggest-item {{:group}} {{:isFirst}} {{:isLast}}'>{{:header}}<a href='{{:url}}' class='ui-autosuggest-link'><table class='foswikiNullTable'><tr><th><div>{{:thumbnail}}</div></th><td>{{:title}}<div class='foswikiGrayText'>{{:container_title}}</div></td></tr></table></a></li>",header:"<div class='ui-autosuggest-title {{:group}}'>{{:title}}</div>",footer:"<li class='ui-autosuggest-item ui-autosuggest-more'><a class='ui-autosuggest-link' href='{{:moreUrl}}'>{{:title}}</a></li>"},focus:function(){return!1},select:function(t,e){return(13===t.keyCode||r.browser.msie)&&(window.location.href=e.item.url),!1},cache:!0,source:null,menuClass:null},_init:function(){var t=this,e=t.menu.element;t.options.thumbnailBase=foswiki.getScriptUrl("rest","ImagePlugin","resize",{size:48,crop:"on"}),e.addClass("ui-autosuggest").removeClass("ui-autocomplete"),t.options.menuClass&&e.addClass(t.options.menuClass),t.options.extraParams.limit=t.options.limits.global,t.templates={}},_initSource:function(){var l=this;l.cache={},l.options.source=l.options.source||foswiki.getScriptUrl("rest","SolrPlugin","autosuggest"),l.source=function(s,a){var t=s.term.replace(/(^\s+)|(\s+$)/g,""),o=t;s.term=t,void 0!==l.options.extraParams&&r.each(l.options.extraParams,function(t,e){var i="function"==typeof e?e(l):e;s[t]=i,o+=";"+t+"="+i}),s.topic=foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC"),l.options.cache&&o in l.cache?a(l.cache[o]):(l.xhr&&l.xhr.abort(),l.xhr=r.ajax({url:l.options.source,data:s,dataType:"json",success:function(t,e,i){l.options.cache&&(l.cache[o]=t),i===l.xhr&&a(t)},error:function(){a([])}}))}},_getTemplate:function(t){var e,i=this,s=i.templates[t];return void 0===s&&void 0!==(e=i.options.templates[t])&&(s=i.templates[t]=r.templates(e)),s},_renderMenu:function(o,t){var l=this;r.each(t,function(t,i){var s,a=i.docs.length;a&&(s=l._getTemplate("header").render({group:i.group,title:r.i18n(i.group)}),r.each(i.docs,function(t,e){t<l.options.limits[i.group]&&("topics"===i.group&&(e.url=foswiki.getScriptUrl("view",e.web,e.topic)),e.phoneNumber=e.field_Telephone_s||e.field_Phone_s||e.field_Mobile_s,e.group=i.group,0===t?(e.isFirst="ui-autosuggest-first-in-group",e.header=s):(e.isFirst="",e.header=""),t===l.options.limits.global-1||t===a-1?e.isLast="ui-autosuggest-last-in-group":e.isLast="",l._renderItemData(o,e))}),r(l._getTemplate("footer").render({moreUrl:i.moreUrl,title:r.i18n("... more")})).data("ui-autocomplete-item",{url:i.moreUrl}).appendTo(o))})},_renderItem:function(t,e){var i,s=this,a=s._getTemplate(e.group)||s._getTemplate("default");return e._done||(e._done=!0,void 0!==e.thumbnail?/^fa-/.test(e.thumbnail)?e.thumbnail="<i  class='fa "+e.icon+"' />":(/^(\/|https?:)/.test(e.thumbnail)?e.thumbnailUrl=e.thumbnail:e.thumbnailUrl=s.options.thumbnailBase+"&topic="+e.web+"."+e.topic+"&file="+e.thumbnail,e.thumbnail="<img class='thumbnail' width='48' src='"+e.thumbnailUrl+"' />"):e.thumbnail="",r.extend(e,s.options.itemData)),i=r(a.render(e)).data("ui-autocomplete-item",e),t.append(i)},_normalize:function(t){return t}})}(jQuery);
