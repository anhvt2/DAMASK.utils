"use strict";!function(s){var t={template:"metadata",debug:!1};function i(e){this.opts=s.extend({},t,e)}i.load=function(e){return new i(e).load()},i.prototype.log=function(){var e;console&&this.opts.debug&&((e=s.makeArray(arguments)).unshift("DIALOG:"),console.log.apply(console,e))},i.prototype.load=function(e){var t,i=s.extend({},this.opts,e),n=void 0===i.id?void 0:s(i.id),r=s.Deferred();function o(e){"function"==typeof i.init&&i.init.call(e)}return this.log("called load() opts=",i),n&&n.length?(n.dialog("open"),n.find("form").resetForm(),o(n),r.resolve(n)):(t=s.extend({},i.data,{name:i.template,expand:i.expand,topic:foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC")}),s.ajax({url:foswiki.getScriptUrl("rest","RenderPlugin","template"),data:t,dataType:"html",success:function(e){var t=s(e);t.one("dialogopen",function(){o(t),r.resolve(t)}),t.appendTo("body")},error:function(e,t,i){r.reject(n,t,i)}})),r.promise()},window.Dialog=i}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery","jquery-ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(_){function e(i){var n="dragover"===i;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==_.inArray("Files",t.types)&&!1!==this._trigger(i,_.Event(i,{delegatedEvent:e}))&&(e.preventDefault(),n&&(t.dropEffect="copy"))}}_.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||_('<input type="file">').prop("disabled")),_.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),_.support.xhrFormDataFileUpload=!!window.FormData,_.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),_.widget("blueimp.fileupload",{options:{dropZone:_(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(i,e){return i=this.messages[i]||i.toString(),e&&_.each(e,function(e,t){i=i.replace("{"+e+"}",t)}),i},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&_(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:_.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||i<n)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&_.support.xhrFileUpload||_.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===_.type(e.formData)?e.formData(e.form):_.isArray(e.formData)?e.formData:"object"===_.type(e.formData)?(i=[],_.each(e.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(e){var i=0;return _.each(e,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?_.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,n=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",_.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",_.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(i){var n=this,e=i.xhr?i.xhr():_.ajaxSettings.xhr();e.upload&&(_(e.upload).bind("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,n._onProgress(e,i)}),i.xhr=function(){return e})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(i){var n,r=this,e=i.files[0],t=i.multipart||!_.support.xhrFileUpload,o="array"===_.type(i.paramName)?i.paramName[0]:i.paramName;i.headers=_.extend({},i.headers),i.contentRange&&(i.headers["Content-Range"]=i.contentRange),t&&!i.blob&&this._isInstanceOf("File",e)||(i.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"'),t?_.support.xhrFormDataFileUpload&&(i.postMessage?(n=this._getFormData(i),i.blob?n.push({name:o,value:i.blob}):_.each(i.files,function(e,t){n.push({name:"array"===_.type(i.paramName)&&i.paramName[e]||o,value:t})})):(r._isInstanceOf("FormData",i.formData)?n=i.formData:(n=new FormData,_.each(this._getFormData(i),function(e,t){n.append(t.name,t.value)})),i.blob?n.append(o,i.blob,e.name):_.each(i.files,function(e,t){(r._isInstanceOf("File",t)||r._isInstanceOf("Blob",t))&&n.append("array"===_.type(i.paramName)&&i.paramName[e]||o,t,t.uploadName||t.name)})),i.data=n):(i.contentType=e.type||"application/octet-stream",i.data=i.blob||e),i.blob=null},_initIframeSettings:function(e){var t=_("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=_(e.fileInput),n=e.paramName;return n?_.isArray(n)||(n=[n]):(n=[],t.each(function(){for(var e=_(this),t=e.prop("name")||"files[]",i=(e.prop("files")||[1]).length;i;)n.push(t),i-=1}),n.length||(n=[t.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=_(e.fileInput.prop("form")),e.form.length||(e.form=_(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===_.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=_.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=_.Deferred(),r=n.promise();return t=t||this.options.context||r,!0===e?n.resolveWith(t,i):!1===e&&n.rejectWith(t,i),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,i){var n=this,r=function(e){return _.Deferred().resolveWith(n,e).promise()};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||r([this])).then(function(){return i.errorThrown?_.Deferred().rejectWith(n,[i]).promise():r(arguments)}).then(e,t)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",_.Event("submit",{delegatedEvent:e}),this)&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&1<i.length&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(o,e){o.uploadedBytes=o.uploadedBytes||0;var t,s,a=this,i=o.files[0],l=i.size,p=o.uploadedBytes,d=o.maxChunkSize||l,u=this._blobSlice,f=_.Deferred(),n=f.promise();return!(!(this._isXHRUpload(o)&&u&&(p||d<l))||o.data)&&(!!e||(l<=p?(i.error=o.i18n("uploadedBytes"),this._getXHRPromise(!1,o.context,[null,"error",i.error])):(s=function(){var n=_.extend({},o),r=n._progress.loaded;n.blob=u.call(i,p,p+d,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+p+"-"+(p+n.chunkSize-1)+"/"+l,a._initXHRData(n),a._initProgressListener(n),t=(!1!==a._trigger("chunksend",null,n)&&_.ajax(n)||a._getXHRPromise(!1,n.context)).done(function(e,t,i){p=a._getUploadedBytes(i)||p+n.chunkSize,r+n.chunkSize-n._progress.loaded&&a._onProgress(_.Event("progress",{lengthComputable:!0,loaded:p-n.uploadedBytes,total:p-n.uploadedBytes}),n),o.uploadedBytes=n.uploadedBytes=p,n.result=e,n.textStatus=t,n.jqXHR=i,a._trigger("chunkdone",null,n),a._trigger("chunkalways",null,n),p<l?s():f.resolveWith(n.context,[e,t,i])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,a._trigger("chunkfail",null,n),a._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(n),n.abort=function(){return t.abort()},s(),n)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,i,n){var r=n._progress.total,o=n._response;n._progress.loaded<r&&this._onProgress(_.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),o.result=n.result=e,o.textStatus=n.textStatus=t,o.jqXHR=n.jqXHR=i,this._trigger("done",null,n)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var i,n,r,o,s=this,a=s._getAJAXSettings(t),l=function(){return s._sending+=1,a._bitrateTimer=new s._BitrateTimer,i=i||((n||!1===s._trigger("send",_.Event("send",{delegatedEvent:e}),a))&&s._getXHRPromise(!1,a.context,n)||s._chunkedUpload(a)||_.ajax(a)).done(function(e,t,i){s._onDone(e,t,i,a)}).fail(function(e,t,i){s._onFail(e,t,i,a)}).always(function(e,t,i){if(s._onAlways(e,t,i,a),s._sending-=1,s._active-=1,a.limitConcurrentUploads&&a.limitConcurrentUploads>s._sending)for(var n=s._slots.shift();n;){if("pending"===s._getDeferredState(n)){n.resolve();break}n=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(e,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(r=_.Deferred(),this._slots.push(r),o=r.then(l)):(this._sequence=this._sequence.then(l,l),o=this._sequence),o.abort=function(){return n=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(a.context,n),l())},this._enhancePromise(o)):l()},_onAdd:function(n,r){var o,e,s,t,a=this,l=!0,i=_.extend({},this.options,r),p=r.files,d=p.length,u=i.limitMultiFileUploads,f=i.limitMultiFileUploadSize,c=i.limitMultiFileUploadSizeOverhead,h=0,g=this._getParamName(i),m=0;if(!d)return!1;if(f&&void 0===p[0].size&&(f=void 0),(i.singleFileUploads||u||f)&&this._isXHRUpload(i))if(i.singleFileUploads||f||!u)if(!i.singleFileUploads&&f)for(s=[],o=[],t=0;t<d;t+=1)h+=p[t].size+c,(t+1===d||h+p[t+1].size+c>f||u&&u<=t+1-m)&&(s.push(p.slice(m,t+1)),(e=g.slice(m,t+1)).length||(e=g),o.push(e),m=t+1,h=0);else o=g;else for(s=[],o=[],t=0;t<d;t+=u)s.push(p.slice(t,t+u)),(e=g.slice(t,t+u)).length||(e=g),o.push(e);else s=[p],o=[g];return r.originalFiles=p,_.each(s||p,function(e,t){var i=_.extend({},r);return i.files=s?t:[t],i.paramName=o[e],a._initResponseObject(i),a._initProgressObject(i),a._addConvenienceMethods(n,i),l=a._trigger("add",_.Event("add",{delegatedEvent:n}),i)}),l},_replaceFileInput:function(e){var i=e.fileInput,n=i.clone(!0),t=i.is(document.activeElement);e.fileInputClone=n,_("<form></form>").append(n)[0].reset(),i.after(n).detach(),t&&n.focus(),_.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?n[0]:t}),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(i,n){var e,r=this,o=_.Deferred(),s=[],a=function(e){e&&!e.entry&&(e.entry=i),o.resolve([e])},l=function(){e.readEntries(function(e){var t;e.length?(s=s.concat(e),l()):(t=s,r._handleFileTreeEntries(t,n+i.name+"/").done(function(e){o.resolve(e)}).fail(a))},a)};return n=n||"",i.isFile?i._file?(i._file.relativePath=n,o.resolve(i._file)):i.file(function(e){e.relativePath=n,o.resolve(e)},a):i.isDirectory?(e=i.createReader(),l()):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,t){var i=this;return _.when.apply(_,_.map(e,function(e){return i._handleFileTreeEntry(e,t)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(_.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):_.Deferred().resolve(_.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,i,n=(e=_(e)).prop("webkitEntries")||e.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if((t=_.makeArray(e.prop("files"))).length)void 0===t[0].name&&t[0].fileName&&_.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=e.prop("value")))return _.Deferred().resolve([]).promise();t=[{name:i.replace(/^.*\\/,"")}]}return _.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof _&&1!==e.length?_.when.apply(_,_.map(e,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var i=this,n={fileInput:_(t.target),form:_(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n),!1!==i._trigger("change",_.Event("change",{delegatedEvent:t}),n)&&i._onAdd(t,n)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,n={files:[]};t&&t.length&&(_.each(t,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),!1!==this._trigger("paste",_.Event("paste",{delegatedEvent:e}),n)&&this._onAdd(e,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,e=t.dataTransfer,n={};e&&e.files&&e.files.length&&(t.preventDefault(),this._getDroppedFiles(e).always(function(e){n.files=e,!1!==i._trigger("drop",_.Event("drop",{delegatedEvent:t}),n)&&i._onAdd(t,n)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),_.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(e,t){var i=-1!==_.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof _||(e.fileInput=_(e.fileInput)),e.dropZone instanceof _||(e.dropZone=_(e.dropZone)),e.pasteZone instanceof _||(e.pasteZone=_(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===_.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var r=this,o=this.options,s=this.element.data();_.each(this.element[0].attributes,function(e,t){var i,n=t.name.toLowerCase();/^data-/.test(n)&&(n=n.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),i=s[n],r._isRegExpOption(n,i)&&(i=r._getRegExp(i)),o[n]=i)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=_.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=_.Deferred(),e=o.promise();return e.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){n||(e.length?(t.files=e,(i=r._onSend(null,t)).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})):o.reject())}),this._enhancePromise(e)}if(t.files=_.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(r){var i={topic:null,progress:null};function t(e,t){this.elem=r(e),this.opts=r.extend({},i,this.elem.data(),t),this.init()}function n(e,t){this.elem=r(e),this.opts=r.extend({},this.elem.data(),t),this.init()}function o(e){var t=this;t.bar=r('<div class="jqUploadProgressBar"><span class="i18n">Uploading ...</span><span class="jqUploadProgressInfo"></span></div>').appendTo(e),t.progressInfo=t.bar.find(".jqUploadProgressInfo"),t.dropIndicator=r('<div class="jqUploadIndicator"><span class="i18n">Drag files here.</span></div>').appendTo(e),t.reset()}t.prototype.init=function(){var n=this;n.uploadedFiles=[],n.elem.fileupload({url:foswiki.getScriptUrl("rest","TopicInteractionPlugin","upload"),fileInput:null,dataType:"json",pasteZone:r(document),sequentialUploads:!0,singleFileUploads:!0,replaceFileInput:!1,progress:function(e,t){var i=[];r.each(t.files,function(e,t){i.push(t.name)}),n.progressBar.add(i)},progressall:function(e,t){var i=parseInt(t.loaded/t.total*100,10);n.progressBar.setProgress(i)},add:function(e,t){t.files=t.files,t.formData=n.opts,t.formData.id=Math.ceil(1e3*Math.random()),t.submit()},paste:function(e,t){if(void 0!==t.files&&t.files.length)return n.currentData=t,Dialog.load({id:"#foswikiAttachmentPaste",expand:"attachments::paste",init:function(){void 0!==n.prevFileName&&this.find("input[name='filename']").val(n.prevFileName)},data:{filename:"clipboard"}}).done(function(e){e.find("form:not(.inited)").addClass("inited").submit(function(){var i=e.find("input[name='filename']").val();return i&&(1<n.currentData.files.length?r.each(n.currentData.files,function(e,t){t.uploadName=i+e,n.prevFileName=t.uploadName}):(n.currentData.files[0].uploadName=i,n.prevFileName=i),n.add(n.currentData),n.currentData=void 0),e.dialog("close"),!1})}),!1},start:function(){n.uploadedFiles=[],n.progressBar.start()},dragover:function(){n.dragoverTimer&&window.clearTimeout(n.dragoverTimer),n.elem.addClass("jqUploadDragging"),n.dragoverTimer=window.setTimeout(function(){n.dragoverTimer=null,n.elem.removeClass("jqUploadDragging")},1e3)},drop:function(){n.dragoverTimer&&window.clearTimeout(n.dragoverTimer),n.dragoverTimer=null,n.elem.removeClass("jqUploadDragging")},done:function(e,t){var i=t.result;r.map(i.result,function(e){n.uploadedFiles.push(e.fileName)})},stop:function(){n.progressBar.stop(),r.pnotify({text:r.i18n("Uploaded %num% file(s)",{num:n.uploadedFiles.length}),type:"success",delay:1e3}),r(".foswikiAttachments").trigger("refresh",[n.uploadedFiles]),n.elem.trigger("afterUpload",[n.uploadedFiles])},fail:function(e,t){var i=t.jqXHR.responseJSON||{error:{message:"unknown error"}};r.pnotify({text:r.i18n("Error: %msg%",{msg:i.error.message}),type:"error"})}}),r(document).bind("drop dragover",function(e){return e.preventDefault(),!1}),n.progressBar=n.elem.data("uploadProgress")},t.prototype.add=function(e){this.elem.fileupload("add",e)},t.prototype.send=function(e){return e.formData=this.opts,e.formData.id=Math.ceil(1e3*Math.random()),this.elem.fileupload("send",e)},n.prototype.init=function(){var e=this;e.elem.on("change",function(){e.add()})},n.prototype.add=function(){return foswiki.uploader.add({fileInput:this.elem.find("input[type=file]")})},n.prototype.send=function(){return foswiki.uploader.send({fileInput:this.elem.find("input[type=file]")})},o.prototype.reset=function(){this.setProgress(0),this.progressInfo.html("")},o.prototype.add=function(e){this.progressInfo.html(e.join(", "))},o.prototype.setProgress=function(e){this.progress=e,this.bar.css("width",e+"%")},o.prototype.getProgress=function(){return this.progress},o.prototype.start=function(){this.reset(),r.blockUI({blockMsgClass:"jqUploadMsg",message:this.bar})},o.prototype.stop=function(){r.unblockUI(),this.reset()},r.fn.uploadButton=function(e){return this.each(function(){r.data(this,"uploadButton")||r.data(this,"uploadButton",new n(this,e))})},r.fn.uploadProgress=function(e){return this.each(function(){r.data(this,"uploadProgress")||r.data(this,"uploadProgress",new o(this,e))})},r.fn.foswikiUploader=function(e){return this.each(function(){foswiki.uploader||(foswiki.uploader=new t(this,e))})},r(function(){i.topic=foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC"),r("body").uploadProgress(),r("body").foswikiUploader(),r(".jqUploadButton:not(.jqUploadButtonInited)").livequery(function(){r(this).uploadButton().addClass("jqUploadButtonInited")})})}(jQuery);var plupload={STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5};!function(r){function t(e,t){var i=this,n=r(e).wrap("<div />").parent().addClass("jqLegacyUploader jqUploadButton");i.wrapper=n,i.elem=r(e),i.fileInput=r("<input />").attr("type","file").appendTo(n),i.opts=r.extend({},i.elem.data(),t),i.init()}t.prototype.init=function(){var i=this;i.state=plupload.STOPPED,i.files=[],i.browseButton=r(i.opts.browseButton)||i.wrapper,i.browseButton.uploadButton(i.opts).addClass("jqUploadButtonInited"),r("body").bind("fileuploadadd",function(e,t){i.files=t.files,i.state=plupload.QUEUED,i.trigger("QueueChange")}).bind("fileuploadstart",function(e,t){i.state=plupload.STARTED,i.files[0].percent=0,i.trigger("StateChanged")}).bind("fileuploadstop",function(e,t){i.files=[],i.state=plupload.STOPPED}).bind("fileuploaddone",function(){i.state=plupload.STOPPED,i.files[0].percent=100,i.trigger("StateChanged")})},t.prototype.bind=function(e,t){this.elem.bind(e,t)},t.prototype.trigger=function(e){return this.elem.trigger(e)},r.fn.uploader=function(e){return console.warn("this uploader api is deprecated, please switch to new fileupload api"),this.each(function(){r.data(this,"uploader")||r.data(this,"uploader",new t(this,e))})}}(jQuery);
